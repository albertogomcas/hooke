#summary How to filter a playlist of force spectroscopy curves
#labels Phase-Support

Only a small fraction of AFM-SMFS force curves contains interesting signals. We developed two simple but nonetheless useful filters that act on the whole data set, discarding curves likely devoid of interesting signals, thus greatly decreasing the time needed for data analysis.

==Flatfilt==
*flatﬁlt*, simply recognizes curves that possess some kind of signiﬁcant feature
above the thermal noise. The ﬁlter cycles all the curves in the playlist. For any given curve:
    * A median window ﬁlter (window size = 7) is applied on the retracting curve
    * A diﬀerence vector, containing the Y difference between contiguous points, is calcu lated.
    * The number of points in the diﬀerence vector exceeding a user-deﬁned threshold is counted
    * If there are enough points exceeding the user-deﬁned threshold, then the curve is kept in the playlist, otherwise it is discarded.
   
This type of ﬁlter is of course very raw, and requires relatively conservative settings to safely avoid false negatives (that is, to avoid discarding interesting curves). Using it on the protein unfolding experiments described in (1) it has been found to reduce the data set to analyze by hand of ∼ 60-80%.


==Convfilt==
The second ﬁlter, *convﬁlt*, relies on automatic recognition of force peaks. Recognition
of peaks is based on a simple convolution algorithm that is an extreme but working simpli-
ﬁcation of the approach of Kasas et.al. (2). Again, the ﬁlter function cycles all curves in
the playlist. For any given retracting curve:

    * The contact point is found and only data before the contact point is used
    * The data before the contact point are convoluted with an L-shaped vector that encodes the approximate L-shape that forced unfolding peaks show after the maximum.
    * The noise level of the convolution is calculated, eliminating the highest values (which are presumibly the spikes) until noise seems converging. Average value and absolute deviation of noise is calculated.
    * Data points exceeding the user-deﬁned threshold of absolute deviation are counted. Usually these data will show up as “clusters” around a single force peak: each cluster is then reduced to a single data point. If there are enough points exceeding the user-deﬁned threshold, then the curve is kept in the playlist, otherwise it is discarded.

The convolution algorithm, with appropriate thresholds, usually recognizes peaks well more than 95% of the time. The ﬁlter based on it can reduce a SMFS dataset like the one in (3) to analyze by hand of about 80-90% (depending on the overall cleanliness of the dataset). Thousands of curves can be automatically filtered this way in a few minutes on a standard PC, but the algorithm could still be optimized.


=Bibliography=
(1) M.Sandal et al. "Conformational equilibria in monomeric alpha synuclein at the single molecule level", PLOS Biology 6:e6 , (2008)

(2) S.Kasas et al. "Fuzzy logic algorithm to extract specific interaction forces from atomic force microscopy data" Rev. Sci. Instrum. 71:2082 (2000)

(3) M.Brucale et al. "Pathogenic mutations shift the equilibria of alpha-synuclein single molecules towards structured conformers." Chembiochem. 2009 Jan 5;10(1):176-83.